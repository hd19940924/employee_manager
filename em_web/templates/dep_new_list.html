{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-3.3.7-dist/css/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'css/toastr.min.css' %}">
</head>
<body>
<script rel="script" src="{% static 'js/jquery-3.2.1.js' %}"></script>
<script rel="script" src="{% static 'plugins/bootstrap-3.3.7-dist/js/bootstrap.js'%}"></script>
<script rel="script" src='{% static "js/toastr.min.js" %}'></script>
<script>
function showDeleteConfirmation(dep_id, dep_name) {

    if (confirm('您确定要删除 ' + dep_name + ' 吗？')) {
        window.location.href = '/dep_del/?del_id=' + dep_id;
        toastr.success(dep_name + ' 已被成功删除！');
    } else {
        toastr.options.positionClass = 'toast-top-center';
        toastr.error('取消删除 ' + dep_name + '！');
    }
     // 进行样式修改
   // toastr.options.positionClass = 'toast-top-left';
    //toastr.options.background = '#28a745';
   // document.querySelectorAll('.toast').forEach(function (el) {
        el.style.color = '#fff';
    //});

}
</script>

<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Employee Manager</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/dep_list/">部门管理 <span class="sr-only">(current)</span></a></li>

                <li class="active"><a href="/emp_list_search/">员工管理 <span class="sr-only">(current)</span></a></li>

                <li><a href="#">Link</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/login/">登录</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/logout">退出系统</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="container">
    <div style="margin-bottom: 10px">
        <!---<form method="post" action="/query_dep/">
            部门名称：<input type="text" name="dep_name" placeholder="请输入部门名称">
            <a class="btn btn-success" href="/query_dep/" target="_blank">
            <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
            查询
        </a>
        </form>-->


        <a class="btn btn-success" href="/dep_add/" target="_blank">
            <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
            新建部门
        </a>
        <div style="float: right; width: 300px">
    <form method="get" action="">
        <div class="input-group">
            <label for="search"></label>
            <input type="text" id="search" name="search" class="form-control" value="{{ search_data }}" placeholder="请输入部门名称 支持模糊查询">
            <span class="input-group-btn">
                <button class="btn btn-default" type="submit">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>
            </span>
        </div>
    </form>
</div>
    </div>
    <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-th" aria-hidden="true"></span>
                部门列表
            </div>
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>部门ID</th>
                    <th>部门名称</th>
                    <th>部门人数</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {% for department in departments %}
            <tr>
                <td>{{ department.id }}</td>
                <td>{{ department.dep_name }}</td>
                <td>{{ department.employee_count }}</td>
                <td>
                        <a class="btn btn-primary btn-xs" href="/dep_update/?update_id={{ department.id}}">编辑</a>
                       <!-- <a class="btn btn-danger btn-xs" href="/dep_del/?del_id={{dep.id}}">删除</a>-->
                       <!-- <a class="btn btn-danger btn-xs" href="#" onClick="showDeleteConfirmation({{dep.id}})">删除</a>-->
                       <!-- <a class="btn btn-danger btn-xs" href="#" onClick="showDeleteConfirmation1({{department.id}})">删除</a>-->
                        <a class="btn btn-danger btn-xs" href="#" onClick="showDeleteConfirmation({{department.id}}, '{{department.dep_name}}')">删除</a>
                        <a class="btn btn-primary btn-xs" href="#" onClick="delete_department({{ department.id }});">Delete</a>

                    </td>
                </tr>
               {% endfor %}
                </tbody>
            </table>
        </div>
    <!-- bootstrap 分页 -->
<ul class="pagination">
    <li><a href="#" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
    <li class="active"><a href="?page=1">1</a></li>
    <li><a href="?page=2">2</a></li>
    <li><a href="?page=3">3</a></li>
    <li><a href="?page=4">4</a></li>
    <li><a href="?page=5">5</a></li>
    <li><a href="#" aria-label="Next"><span aria-hidden="true">»</span></a></li>
</ul>


</div>

</body>

</html>
<script>
function showDeleteConfirmation1(dep_id) {
if (confirm('您确定要删除吗？')) {
    $.ajax({
        url: '/dep_del/?del_id=' + dep_id,
        success: function(response) {
            if (response.status == 'success') {
                toastr.success(response.message);
                // Remove the deleted department element from the list
                $('#dep_' + dep_id).remove();
            } else {
                toastr.error(response.message);
            }
        },
        error: function(xhr, status, error) {
            toastr.error('删除失败，请稍后再试。');
        }
    });
}
</script>
<script>
function delete_department(department_id) {
    // 发送 Ajax 请求，删除指定部门
    $.ajax({
        url: "/delete_department/",
        type: "POST",
        dataType: "json",
        data: {
            'department_id': department_id,
             'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            if (response.success) {
                // 删除成功，刷新列表
                location.reload();
            } else {
                // 处理删除失败的情况
                alert("删除部门失败！");
            }
        },
        error: function(xhr,errmsg,err) {
            // 处理 Ajax 请求错误的情况
            alert("Ajax error!");
        }
    });
}
</script>